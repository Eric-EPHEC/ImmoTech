@page "/external-callback"

@inject NavigationManager Nav
@inject IJSRuntime JS
@inject Blazored.Toast.Services.IToastService Toast

<p>Connexion en cours...</p>

@code {
    protected override async Task OnInitializedAsync()
    {
        // extract token param from query
        var uri = Nav.ToAbsoluteUri(Nav.Uri);
        var queryDict = Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(uri.Query);
        queryDict.TryGetValue("token", out var tokenValues);
        var token = tokenValues.FirstOrDefault();

        if (!string.IsNullOrWhiteSpace(token))
        {
            await JS.InvokeVoidAsync("localStorage.setItem", "authToken", token);
            Toast.ShowSuccess("Connecté");
            Nav.NavigateTo("/");
        }
        else
        {
            Toast.ShowError("Échec de la connexion externe");
            Nav.NavigateTo("/login");
        }
    }
} 